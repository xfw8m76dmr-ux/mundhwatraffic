<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üö¶ Mundhwa Bridge Pune Traffic Live | Real-Time Camera</title>
  <meta name="description" content="Watch live Mundhwa Bridge traffic in Pune, India ‚Äî streaming 24/7 with RoadX smart camera technology. Check road conditions before you travel." />
  <meta name="robots" content="index,follow,max-image-preview:large" />

  <!-- CSS -->
  <link rel="stylesheet" href="/style.css">

  <!-- OG -->
  <meta property="og:title" content="üö¶ Mundhwa Traffic Live | Pune" />
  <meta property="og:description" content="Watch Mundhwa Bridge traffic live from Pune. Real-time RoadX camera feed updated 24/7." />
  <meta property="og:image" content="https://mundhwatraffic.com/assets/og-preview.png" />
  <meta property="og:url" content="https://mundhwatraffic.com" />
  <meta property="og:type" content="video.other" />

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="üö¶ Mundhwa Traffic Live | Pune">
  <meta name="twitter:description" content="Watch real-time traffic at Mundhwa Bridge, Pune, India.">
  <meta name="twitter:image" content="https://mundhwatraffic.com/assets/og-preview.png">

  <link rel="icon" href="/favicon-32x32.png" sizes="32x32" />
  <link rel="apple-touch-icon" href="/favicon-512.png" />
  <link rel="manifest" href="/site.webmanifest" />

  <!-- Keep GA preload & loader (preserved ID and behavior) -->
  <link rel="preload" href="https://www.googletagmanager.com/gtag/js?id=G-TVFRVGXERM" as="script">

  <!-- FAQ Schema -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      { "@type": "Question", "name": "Is Mundhwa Bridge jammed right now?",
        "acceptedAnswer": { "@type": "Answer", "text": "Check real-time status on this page." }
      },
      { "@type": "Question", "name": "Peak timings?",
        "acceptedAnswer": { "@type": "Answer", "text": "9‚Äì11 AM and 6‚Äì8:30 PM." }
      },
      { "@type": "Question", "name": "Delay?",
        "acceptedAnswer": { "@type": "Answer", "text": "Usually 5‚Äì25 minutes." }
      },
      { "@type": "Question", "name": "Live camera?",
        "acceptedAnswer": { "@type": "Answer", "text": "Yes, updated every few minutes." }
      },
      { "@type": "Question", "name": "Accuracy?",
        "acceptedAnswer": { "@type": "Answer", "text": "Updated regularly using live snapshots." }
      }
    ]
  }
  </script>

  <!-- LocalBusiness Schema -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "LocalBusiness",
    "name": "Mundhwa Traffic Live",
    "description": "Real-time Mundhwa Bridge traffic and live CCTV updates.",
    "areaServed": "Mundhwa, Pune",
    "url": "https://mundhwatraffic.com"
  }
  </script>

  <!-- GA Loader (preserved) -->
  <script defer>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }

    (function loadGA(){
      const s = document.createElement('script');
      s.src = "https://www.googletagmanager.com/gtag/js?id=G-TVFRVGXERM";
      s.async = true;
      s.onload = function() {
        gtag('js', new Date());
        gtag('config', 'G-TVFRVGXERM', { anonymize_ip: true, transport_type:'beacon' });
      };
      s.onerror = () => setTimeout(loadGA, 1500);
      document.head.appendChild(s);
    })();
  </script>

  <!-- Small helper to run things when browser is idle -->
  <script>
    window.runWhenIdle = function(fn, fallbackDelay = 2000){
      if ('requestIdleCallback' in window) {
        requestIdleCallback(fn, {timeout: 3000});
      } else {
        setTimeout(fn, fallbackDelay);
      }
    };
  </script>

  <!-- Defer loading heavy third-party assets (ads + OneSignal) until idle / user action -->
  <script>
    // Lazy-load Adsense JS only when ad slot becomes visible or when idle
    function loadAdsense(){
      if (window.__adsenseLoaded) return;
      window.__adsenseLoaded = true;
      const s = document.createElement('script');
      s.src = "https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3625430905597433";
      s.async = true;
      s.crossOrigin = "anonymous";
      document.head.appendChild(s);
    }

    // OneSignal loader ‚Äî will initialize after loadOneSignal() called.
    function loadOneSignalSDK(callback){
      if (window.__oneSignalLoading) {
        if (callback) window.__oneSignalLoading.push(callback);
        return;
      }
      window.__oneSignalLoading = [];
      if (callback) window.__oneSignalLoading.push(callback);

      const s = document.createElement('script');
      s.src = "https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js";
      s.defer = true;
      s.onload = function(){
        // run queued callbacks
        const q = window.__oneSignalLoading || [];
        q.forEach(fn => { try { fn(); } catch(e){console.error(e);} });
      };
      s.onerror = function(){ console.error('OneSignal SDK failed to load'); };
      document.head.appendChild(s);
    }

    // When ad container gets close to viewport, load ads
    function observeAdContainer(){
      const adContainer = document.getElementById('bottomAdContainer');
      if (!adContainer) return;
      if ('IntersectionObserver' in window){
        const io = new IntersectionObserver(entries => {
          entries.forEach(e => {
            if (e.isIntersecting){
              loadAdsense();
              io.disconnect();
            }
          });
        }, {rootMargin: '300px'});
        io.observe(adContainer);
      } else {
        // fallback: load on idle
        runWhenIdle(loadAdsense, 600);
      }
    }

    // Kick off non-critical loads on idle
    runWhenIdle(() => {
      observeAdContainer();
      // Load OneSignal only after idle ‚Äî keep SDK off critical path
      loadOneSignalSDK();
    }, 1000);
  </script>

  <!-- small tracking script (deferred to not block render) -->
  <script src="/tracking.js" defer></script>

  <style>
    /* inline critical CSS to avoid FOIT/CLS for some elements */
    #yt-container { position:relative; width:100%; max-width:960px; margin:0 auto; }
    #yt-container img, #yt-container iframe { display:block; width:100%; height:auto; }
    #yt-overlay { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; cursor:pointer; }
    /* reserve ad height to avoid CLS */
    #bottomAdContainer { height:60px; }
    .notify-btn { cursor:pointer; }
    #share-icons img { width:40px; height:40px; display:inline-block; }
  </style>

</head>

<body>

<header>üö¶ Live Traffic View ‚Äì Mundhwa Bridge, Pune</header>

<div class="page-intro">
  <p>Mundhwa Bridge is one of Pune‚Äôs busiest choke points connecting major IT hubs.</p>
  <p>This live stream helps commuters check real-time traffic before leaving.</p>
</div>

<main>

  <!-- VIDEO -->
  <div id="yt-container" aria-label="Live camera preview">
    <img src="https://mundhwatraffic.com/assets/video_background.png"
         alt="Mundhwa Bridge Live Traffic Pune Preview"
         width="960" height="540" loading="eager" fetchpriority="high">
    <div id="yt-overlay" role="button" aria-label="Play live stream"><span>Play Live</span></div>
  </div>

  <!-- NOTIFY CTA -->
  <div class="notify-wrap">
    <button id="notifyBtn" class="notify-btn" aria-describedby="notifyHelp">üîî Get Heavy Traffic Alerts</button>
    <div class="notify-desc">No spam ‚Äî only realtime jam alerts.</div>
    <div class="notify-desc">AI-powered alerts ‚Äî may be imperfect.</div>
  </div>

  <div id="notifyHelp" style="display:none"></div>

  <!-- SHARE -->
  <section>
    <h3>üì¢ Share MundhwaTraffic with someone stuck in traffic üöó‚ö†Ô∏è</h3>
    <div id="share-icons">
      <a href="https://api.whatsapp.com/send?text=üö¶%20Check%20Mundhwa%20Traffic%20Live%20https://mundhwatraffic.com/w" aria-label="Share on WhatsApp">
        <img src="/assets/icons/whatsapp.svg" alt="WhatsApp" width="40" height="40" loading="lazy">
      </a>
      <a href="https://twitter.com/intent/tweet?text=üö¶%20Mundhwa%20Traffic%20Live&url=https://mundhwatraffic.com/x" aria-label="Share on X">
        <img src="/assets/icons/x.svg" alt="X" width="40" height="40" loading="lazy">
      </a>
      <a href="https://www.facebook.com/sharer/sharer.php?u=https://mundhwatraffic.com/f" aria-label="Share on Facebook">
        <img src="/assets/icons/facebook.svg" alt="Facebook" width="40" height="40" loading="lazy">
      </a>
      <img id="nativeShareBtn" src="/assets/icons/share.svg" alt="Native share" width="40" height="40" loading="lazy" style="cursor:pointer;">
    </div>
  </section>

  <p id="bookmarkHelp"></p>

  <div id="viewer-count">üî¥ Live on YouTube</div>

  <button id="installBtn" class="primary-btn" style="display:none;">üì± Add to Home Screen</button>

  <!-- CONTENT CARDS -->
  <section id="traffic-info">

    <div class="section-card">
      <h2>üöó About Mundhwa Bridge Traffic</h2>
      <p>Mundhwa Bridge often changes traffic conditions within minutes due to metro work, lane blocks, office hours, weather, and more.</p>
      <p>This live camera helps commuters choose smarter routes.</p>
    </div>

    <div class="section-card">
      <h3>üïí Peak Traffic Timings</h3>
      <ul>
        <li><strong>Morning:</strong> 9:00 ‚Äì 11:00 AM</li>
        <li><strong>Evening:</strong> 6:00 ‚Äì 8:30 PM</li>
      </ul>
    </div>

    <div class="section-card">
      <h3>üìä What Affects Traffic?</h3>
      <ul>
        <li>Metro & road construction</li>
        <li>Breakdowns & accidents</li>
        <li>IT park commute surge</li>
        <li>School timings</li>
        <li>Rain or weather issues</li>
      </ul>
    </div>

    <div class="section-card">
      <h3>üõ£Ô∏è Why This Camera Exists</h3>
      <p>Thousands check this camera daily to decide whether to take Mundhwa or detour via Magarpatta.</p>
    </div>

    <div class="section-card">
      <h3>‚ö†Ô∏è Important Note</h3>
      <p>Occasional interruptions may occur due to maintenance or connectivity issues.</p>
    </div>

  </section>

  <div id="debugBox"></div>

</main>

<footer>
  ¬© 2025 <a href="/">mundhwatraffic.com</a> |
  <a href="/about.html">About</a> |
  <a href="/privacy.html">Privacy Policy</a> |
  <a href="/terms.html">Terms of Use</a><br>
  Powered by <strong>RoadX Traffic Cameras</strong>
</footer>

<!-- YT PLAYER -->
<script>
document.getElementById("yt-overlay").addEventListener("click", () => {
  const c = document.getElementById("yt-container");
  while (c.firstChild) c.removeChild(c.firstChild);
  const iframe = document.createElement("iframe");
  iframe.src="https://www.youtube.com/embed/live_stream?channel=UCOCdYbhwwwgNXj58pHsU1Fw&autoplay=1&mute=1&playsinline=1&enablejsapi=1&rel=0&controls=1&origin=https://mundhwatraffic.com";
  iframe.allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture;";
  iframe.allowFullscreen = true;
  c.appendChild(iframe);
});
setInterval(() => {
  const iframe=document.querySelector("#yt-container iframe");
  if (iframe && iframe.contentWindow){
    try { iframe.contentWindow.postMessage('{"event":"command","func":"playVideo"}',"*"); } catch(e){}
  }
},15000);
</script>

<!-- SHARE BUTTON -->
<script>
const nativeShareBtn = document.getElementById("nativeShareBtn");
if (navigator.share){
  nativeShareBtn.addEventListener("click", () => {
    navigator.share({
      title: "üö¶ Mundhwa Traffic Live | Pune",
      text: "Check live Mundhwa Bridge traffic.",
      url: "https://mundhwatraffic.com/web"
    });
  });
} else {
  nativeShareBtn.style.opacity="0.4";
}
</script>

<!-- INSTALL PWA -->
<script>
let deferredPrompt;
const installBtn=document.getElementById("installBtn");
window.addEventListener("beforeinstallprompt",(e)=>{
  e.preventDefault();
  deferredPrompt=e;
  installBtn.style.display="inline-flex";
});
installBtn.addEventListener("click",()=>{
  installBtn.style.display="none";
  deferredPrompt.prompt();
});
</script>

<!-- OneSignal: DO NOT include the SDK immediately in <head>.  Load lazily & initialize on demand.
     OneSignal appId preserved as requested.
-->
<script>
/* OneSignal init deferral + helper queue */
window.OneSignalDeferred = window.OneSignalDeferred || [];
function ensureOneSignalInitialized(initFn){
  // if OneSignal global exists, call init immediately
  if (window.OneSignal && typeof window.OneSignal.init === 'function'){
    initFn(window.OneSignal);
    return;
  }
  // else load sdk if not already, then queue
  loadOneSignalSDK(() => {
    // sometimes OneSignal attaches to window.OneSignal after SDK load
    if (window.OneSignal){
      try { initFn(window.OneSignal); } catch(e){ console.error(e); }
    } else {
      // queue as fallback
      window.OneSignalDeferred.push(initFn);
    }
  });
}

/* function to initialize OneSignal with your appId (preserved) */
function initOneSignal(OneSignal){
  try{
    OneSignal.init({
      appId: "4431abd4-0179-41dd-8336-d8ba2f83f93a",
      serviceWorkerPath: "OneSignalSDKWorker.js",
      serviceWorkerParam: { scope: "/" },
      notifyButton: { enable: false }
    });
  }catch(e){ console.error('OneSignal init error', e); }
}

/* If user clicks notifyBtn, ensure OneSignal is loaded and immediately init+subscribe flow */
const notifyBtn = document.getElementById("notifyBtn");
const notifyHelp = document.getElementById("notifyHelp");
notifyBtn.addEventListener("click", async () => {

  // UI checks (facebook in-app / iOS PWA) preserved
  const ua = navigator.userAgent.toLowerCase();
  const isIOS = /iphone|ipad|ipod/.test(ua);
  const isPWA = window.matchMedia('(display-mode: standalone)').matches || navigator.standalone === true;
  const isFacebookBrowser = navigator.userAgent.includes("FBAN") || navigator.userAgent.includes("FBAV");
  const isInstagramBrowser = navigator.userAgent.includes("Instagram");

  function showToast(message){
    const t=document.createElement("div");
    t.textContent=message;
    t.style=`
      position:fixed; bottom:20px; left:50%; transform:translateX(-50%);
      background:#222; color:#fff; padding:12px 18px;
      border-radius:8px; font-size:14px; opacity:0;
      transition:opacity .4s; z-index:99999;
    `;
    document.body.appendChild(t);
    requestAnimationFrame(()=>{ t.style.opacity=1; });
    setTimeout(()=>{
      t.style.opacity=0;
      setTimeout(()=>t.remove(),400);
    },7000);
  }

  if (isFacebookBrowser || isInstagramBrowser){
    if (isIOS){
      showToast(`
‚ö†Ô∏è iOS does not allow notifications inside Facebook.

To enable alerts:
1Ô∏è‚É£ Tap ‚Ä¢‚Ä¢‚Ä¢
2Ô∏è‚É£ Open in Safari
3Ô∏è‚É£ Add to Home Screen
4Ô∏è‚É£ Open from Home Screen then tap Notify again.
      `);
    } else {
      showToast(`
‚ö†Ô∏è FB In-App Browser doesn't support notifications.
Tap menu ‚Üí Open in Browser ‚Üí choose Chrome.
      `);
    }
    return;
  }

  if (isIOS && !isPWA){
    showToast(`
üì± Add to Home Screen required for iOS alerts.

Tap Share ‚Üí "Add to Home Screen".
    `);
    return;
  }

  // Load OneSignal SDK if necessary, then run the subscribe flow
  ensureOneSignalInitialized((OneSignal) => {
    try{
      // request permission using OneSignal API (the API surface can vary across versions)
      // This tries to follow your prior flow while guarding for missing methods.
      (async () => {
        try {
          // if the new API exists:
          if (OneSignal.isPushNotificationsSupported && !OneSignal.isPushNotificationsSupported()){
            showToast("üîï Push not supported in this browser.");
            return;
          }

          // modern SDK: show native prompt or use SDK flow
          if (OneSignal.showSlidedown && typeof OneSignal.showSlidedown === 'function'){
            // optional: show slidedown (we disabled notify button via init), fallback to requestPermission below
          }

          showToast("‚è≥ Subscribing‚Ä¶");

          // request permission using SDK helpers where available
          if (OneSignal.getNotificationPermission){
            const perm = OneSignal.getNotificationPermission();
            if (perm === 'granted'){
              showToast("‚úÖ Alerts already enabled!");
              return;
            }
          }

          // call SDK's permission request if available
          if (OneSignal.registerForPushNotifications){
            await OneSignal.registerForPushNotifications();
            const ok = await OneSignal.isPushNotificationsEnabled ? await OneSignal.isPushNotificationsEnabled() : true;
            showToast(ok ? "‚úÖ Alerts enabled!" : "‚ö†Ô∏è Subscription failed.");
          } else if (OneSignal.showNativePrompt){
            await OneSignal.showNativePrompt();
            showToast("‚úÖ Alerts enabled!");
          } else {
            // fallback: attempt the older API
            try {
              await OneSignal.PushSubscription?.optIn?.();
              showToast("‚úÖ Alerts enabled!");
            } catch(e){
              showToast("‚ö†Ô∏è Alerts subscription fallback used.");
            }
          }
        } catch(e){
          console.error(e);
          showToast("‚ö†Ô∏è Could not complete subscription.");
        }
      })();
    } catch(e){
      console.error(e);
      showToast("‚ö†Ô∏è OneSignal init error.");
    }
  });
});
</script>

<!-- iOS keepalive audio (unchanged) -->
<script>
(function(){
  const ua=navigator.userAgent.toLowerCase();
  const isIOS=/iphone|ipad|ipod/.test(ua);
  const isPWA=window.matchMedia('(display-mode: standalone)').matches || navigator.standalone===true;

  if (isIOS && isPWA){
    const audio=document.createElement("audio");
    audio.autoplay=true; audio.loop=true; audio.hidden=true;
    audio.src="data:audio/mp3;base64,//uQxAAAAAAAAAAAAAAAAAAA...";
    document.body.appendChild(audio);
  }
})();
</script>

<!-- Error tracking -->
<script>
window.addEventListener("error",(e)=>{
  try {
    navigator.sendBeacon && navigator.sendBeacon('/errors', JSON.stringify({
      type:"error",message:e.message,file:e.filename,line:e.lineno,col:e.colno,
      stack:e.error?.stack,url:location.href,ua:navigator.userAgent
    })) || fetch("/errors",{method:"POST",body:JSON.stringify({
      type:"error",message:e.message,file:e.filename,line:e.lineno,col:e.colno,
      stack:e.error?.stack,url:location.href,ua:navigator.userAgent
    })});
  } catch(err){}
});
window.addEventListener("unhandledrejection",(e)=>{
  try {
    navigator.sendBeacon && navigator.sendBeacon('/errors', JSON.stringify({
      type:"promise",reason:String(e.reason),stack:e.reason?.stack,url:location.href,ua:navigator.userAgent
    })) || fetch("/errors",{method:"POST",body:JSON.stringify({
      type:"promise",reason:String(e.reason),stack:e.reason?.stack,url:location.href,ua:navigator.userAgent
    })});
  } catch(err){}
});
</script>

<div style="height:80px;"></div>

<!-- Ads container (reserved height to avoid CLS). ad loading happens lazily when in view -->
<div id="bottomAdContainer" style="
  width:100%; height:60px; position:fixed; bottom:0; left:0;
  z-index:9999; background:rgba(0,0,0,0.92); display:flex;
  align-items:center; justify-content:center; box-shadow:0 -2px 8px rgba(0,0,0,0.3);
">
  <ins id="adSlot" class="adsbygoogle"
      style="display:inline-block;width:100%;height:60px;"
      data-ad-client="ca-pub-3625430905597433"
      data-ad-slot="5393173301"
      data-ad-format="horizontal"
      data-full-width-responsive="false"></ins>
</div>

<!-- Trigger initial observers on DOM ready -->
<script>
document.addEventListener('DOMContentLoaded', function(){
  // start observing ad container (loads adsense on idle or when visible)
  if (typeof observeAdContainer === 'function') observeAdContainer();

  // Run a light background load of non-critical items after a small delay
  runWhenIdle(() => {
    // small things that are safe to prefetch
    // e.g. warm DNS for cdn or preconnects if needed (optional)
    try {
      const link = document.createElement('link');
      link.rel = 'preconnect';
      link.href = 'https://pagead2.googlesyndication.com';
      document.head.appendChild(link);
    } catch(e){}
  }, 1500);
});
</script>

</body>
</html>
